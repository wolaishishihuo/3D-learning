---
description: 3D-learning 项目 Demo/Project 文件生成规范
globs: src/demos/**/*.vue, src/projects/**/*.vue
alwaysApply: false
---

# Demo/Project 文件生成规范

在 3D-learning 项目中生成 Demo 或 Project 文件时，必须遵循以下规范：

## Demo 文件必须使用的公共组件和函数

1. **useThreeScene** composable 初始化场景（自动处理场景、相机、渲染器、控制器、响应式尺寸、**自动 cleanup**）
2. **SceneCard** 组件包裹场景容器（提供全屏功能）
3. **Summary** + **SummaryItem** 组件展示知识总结
4. **CodeBlock** 组件展示关键代码片段
5. **Code** 组件高亮 API 名称

## Demo 模板结构

```vue
<script setup lang="ts">
import * as THREE from 'three';
import type { CodeSnippet } from '@/components/CodeBlock/index.vue';

const sceneCardRef = ref();

const codeSnippets: CodeSnippet[] = [
  {
    title: '代码片段标题',
    code: `// 代码内容`,
    language: 'typescript'
  }
];

// 获取 SceneCard 内部容器的 ref
const containerRef = computed(() => sceneCardRef.value?.container);

// 在 setup 顶层调用，无需 onMounted，自动处理 cleanup
useThreeScene(containerRef, {
  cameraPosition: [100, 100, 100],
  showGridHelper: true,
  showAxesHelper: true,
  onReady: ({ scene }) => {
    // TODO: 在这里添加场景内容
    console.log('Scene ready:', scene);
  }
});
</script>

<template>
  <div class="demo-scene flex flex-col gap-6">
    <SceneCard ref="sceneCardRef" title="场景标题" height="500px" />

    <Summary title="知识点总结">
      <SummaryItem title="知识点">描述 <Code>API</Code></SummaryItem>
      <template #tip>
        <strong>提示：</strong>补充说明
      </template>
    </Summary>

    <CodeBlock title="关键代码" :snippets="codeSnippets" />
  </div>
</template>

<style lang="scss">
@use '@/demos/index.scss';
</style>
```

## Project 模板结构

```vue
<template>
  <div class="project-container relative">
    <div class="absolute left-0 top-0 z-10 p-4">
      <h1 class="text-2xl font-bold text-white">项目标题</h1>
      <p class="text-sm text-gray-500">项目描述</p>
    </div>
    <div ref="containerRef" class="canvas-container"></div>
  </div>
</template>

<script setup lang="ts">
const containerRef = ref<HTMLDivElement>();

// 在 setup 顶层调用，无需 onMounted，自动处理 cleanup
useThreeScene(containerRef, {
  cameraPosition: [100, 100, 100],
  showGridHelper: true,
  showAxesHelper: true,
  onReady: ({ scene }) => {
    // TODO: 在这里添加场景内容
    console.log('Scene ready:', scene);
  }
});
</script>

<style scoped lang="scss">
.project-container {
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

.canvas-container {
  width: 100%;
  height: 100%;
}
</style>
```

## useThreeScene API

**参数**:
- `containerRef` (必填): `Ref<HTMLElement | undefined | null>`，容器元素的响应式引用
- `options` (可选): 配置对象

**Options 配置**:
```ts
interface ThreeSceneOptions {
  cameraPosition?: [number, number, number];  // 相机位置，默认 [0, 20, 50]
  cameraLookAt?: [number, number, number];    // 相机朝向，默认 [0, 0, 0]
  showAxesHelper?: boolean;                   // 显示坐标轴，默认 true
  showGridHelper?: boolean;                   // 显示网格，默认 true
  backgroundColor?: number;                   // 背景颜色，默认 0x000000
  fov?: number;                               // 视场角，默认 45
  onReady?: (context: ThreeSceneContext) => void;  // 初始化完成回调
}
```

**onReady 回调参数**:
```ts
interface ThreeSceneContext {
  scene: THREE.Scene;
  camera: THREE.PerspectiveCamera;
  renderer: THREE.WebGLRenderer;
  controls: OrbitControls;
}
```

## 重要注意事项

1. **课程分段合并**：课程列表中的（一）（二）分段应合并为同一个文件/项目
2. **配置更新**：新增 Demo 需更新 `src/demos/config.ts`，新增 Project 需同时更新 `src/projects/config.ts` 和 `src/router/index.ts`
3. **自动清理**：`useThreeScene` 会在组件卸载时自动清理资源，**无需手动调用 cleanup**
4. **自动导入**：`ref`、`computed`、`useThreeScene`、`SceneCard`、`Summary`、`SummaryItem`、`CodeBlock`、`Code` 等均已配置自动导入，无需手动 import
5. **使用 onReady 回调**：在 `onReady` 回调中添加 3D 对象，而不是在 `onMounted` 中操作
